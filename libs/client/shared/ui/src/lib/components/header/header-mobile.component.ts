import { Component, signal, effect, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterLink } from '@angular/router';
import { TranslateModule } from '@ngx-translate/core';
import { IconComponent } from '../../icons/icon.component';
import { LanguageSwitcherComponent } from '../language-switcher/language-switcher.component';

@Component({
  selector: 'app-header-mobile',
  standalone: true,
  imports: [CommonModule, LanguageSwitcherComponent, RouterLink, TranslateModule],
  template: `
    <div class="md:hidden flex items-center gap-3 z-[100]">
      <button 
        (click)="toggleMenu()"
        class="focus:outline-none"
        [attr.aria-label]="isOpen() ? 'Fermer le menu' : 'Ouvrir le menu'"
        [attr.aria-expanded]="isOpen()"
      >
        <svg *ngIf="!isOpen()" width="32" height="28" viewBox="0 0 32 28" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M27.7516 0H24.8104C18.3266 0.186667 1.86535 0.693333 1.4916 0.693333C1.40323 0.679968 1.31238 0.682589 1.22537 0.701012C1.13836 0.719436 1.0573 0.753217 0.987852 0.8C0.270441 1.67014 -0.0726712 2.7118 0.0128526 3.76C0.00458196 4.55703 0.130351 5.35118 0.386603 6.12C0.481522 6.40598 0.679815 6.66166 0.955352 6.85333C1.17947 6.95028 1.42073 7.01777 1.67035 7.05333C2.11941 7.14801 2.57532 7.21926 3.03535 7.26667L6.7891 7.41333C9.40535 7.41333 14.7516 7.53333 19.3829 7.52C24.0141 7.50667 27.9954 7.42667 28.0279 7.41333C28.5208 7.264 28.9231 6.96258 29.1491 6.57333C29.6656 5.64556 29.9158 4.63291 29.8804 3.61333C29.8804 2.02667 29.1166 0.4 27.7516 0ZM27.6541 5.48C27.587 5.63393 27.4999 5.78146 27.3941 5.92L6.80535 6.25333H3.0841L1.6541 6.02667C1.59181 5.92748 1.53752 5.82503 1.4916 5.72C1.2051 4.91085 1.08429 4.06828 1.1341 3.22667C1.10679 2.65392 1.25779 2.08491 1.57285 1.57333C3.3441 1.57333 12.6716 1.57333 19.6429 1.50667H26.6629H27.1179H27.3291C27.7638 1.92558 27.9901 2.46358 27.9629 3.01333C28.0599 3.84422 27.9549 4.68264 27.6541 5.48Z" fill="black"/>
          <path d="M31.3787 0.746641C31.4365 0.78367 31.5028 0.810866 31.5737 0.826641C31.5193 0.785306 31.4516 0.757555 31.3787 0.746641Z" fill="black"/>
          <path d="M28.1449 9.85331H25.4637L4.33867 10.4266C4.18783 10.4266 4.04317 10.4758 3.9365 10.5633C3.82984 10.6508 3.76992 10.7695 3.76992 10.8933C3.77415 11.0183 3.83765 11.137 3.9469 11.2241C4.05616 11.3113 4.20254 11.36 4.35492 11.36L27.4299 11.24C28.0474 11.44 28.1774 12.1333 28.2749 12.8666C28.3675 13.6878 28.2683 14.516 27.9824 15.3066C27.9138 15.4666 27.821 15.6189 27.7062 15.76L7.13367 16.08H3.39617L2.01492 15.8933C2.01492 15.8266 1.85242 15.7066 1.80367 15.5866C1.52532 14.7761 1.40467 13.9347 1.44617 13.0933C1.39628 12.4406 1.61362 11.793 2.06367 11.2533C2.11035 11.216 2.14746 11.1715 2.17279 11.1222C2.19813 11.073 2.21118 11.0201 2.21118 10.9666C2.21118 10.9132 2.19813 10.8603 2.17279 10.8111C2.14746 10.7618 2.11035 10.7172 2.06367 10.68C2.01685 10.6413 1.96115 10.6106 1.89979 10.5896C1.83844 10.5686 1.77263 10.5578 1.70617 10.5578C1.63971 10.5578 1.5739 10.5686 1.51255 10.5896C1.45119 10.6106 1.3955 10.6413 1.34867 10.68C0.599709 11.5344 0.237643 12.5766 0.324921 13.6266C0.339203 14.4314 0.492393 15.2305 0.779921 16C0.870845 16.2911 1.06955 16.552 1.34867 16.7466C1.57396 16.8413 1.8148 16.9087 2.06367 16.9466C2.51305 17.0401 2.96887 17.1114 3.42867 17.16L7.19867 17.3333C9.42492 17.3333 13.6987 17.44 17.6799 17.4533C23.1562 17.4533 28.3724 17.3333 28.4374 17.32C28.6788 17.2486 28.9007 17.1389 29.0903 16.997C29.28 16.8551 29.4336 16.684 29.5424 16.4933C30.0638 15.5574 30.3141 14.5352 30.2737 13.5066C30.2412 11.8 29.4937 10.2533 28.1449 9.85331Z" fill="black"/>
          <path d="M27.7605 20H24.8192C18.3192 20.1733 1.87424 20.6933 1.50049 20.64C1.41098 20.6242 1.31808 20.6269 1.23015 20.6478C1.14222 20.6688 1.06201 20.7073 0.996738 20.76C0.251622 21.6397 -0.0934415 22.7062 0.0217378 23.7733C0.0134671 24.5704 0.139236 25.3645 0.395488 26.1333C0.50239 26.4035 0.699422 26.6437 0.964238 26.8267C1.19299 26.9113 1.43292 26.974 1.67924 27.0133C2.12614 27.1157 2.58275 27.1871 3.04424 27.2267L6.79799 27.3733C9.41424 27.3733 14.7442 27.4933 19.3917 27.48C24.0392 27.4667 27.988 27.3867 28.0367 27.3733C28.5261 27.2193 28.9266 26.9193 29.158 26.5333C29.6769 25.6015 29.9272 24.5841 29.8892 23.56C29.8567 21.96 29.1092 20.4 27.7605 20ZM27.6467 25.4933C27.5797 25.6473 27.4925 25.7948 27.3867 25.9333L6.79799 26.2667H3.07674L1.64674 26.04C1.57483 25.9383 1.51497 25.8311 1.46799 25.72C1.20299 24.9076 1.08796 24.0671 1.12674 23.2267C1.13207 22.6489 1.31065 22.0811 1.64674 21.5733H19.7005H26.7367H27.1917H27.403C27.8309 21.9954 28.0562 22.5312 28.0367 23.08C28.091 23.8974 27.9587 24.7158 27.6467 25.4933Z" fill="black"/>
          <path d="M22.2462 21.3333C22.3019 21.373 22.369 21.4005 22.4412 21.4133C22.3844 21.3749 22.3177 21.3476 22.2462 21.3333Z" fill="black"/>
        </svg>

        <svg *ngIf="isOpen()" class="cursor-pointer" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M23.011 0.416486C20.3511 2.60304 17.3955 5.18872 14.5095 7.87853C13.6055 8.72885 12.771 9.61388 11.8495 10.4642C11.2758 9.87419 10.7195 9.26681 10.111 8.72885C6.28618 4.87636 2.63522 1.56182 0.914055 0.156182C0.866966 0.10683 0.810325 0.0675378 0.747566 0.0406907C0.684807 0.0138435 0.617239 0 0.548959 0C0.48068 0 0.413112 0.0138435 0.350354 0.0406907C0.287595 0.0675378 0.230953 0.10683 0.183864 0.156182C0.0882987 0.253499 0.034771 0.384337 0.034771 0.520608C0.034771 0.656878 0.0882987 0.787716 0.183864 0.885033C1.66163 2.27332 4.49547 5.53579 7.8161 9.11063L10.3718 11.8525C9.43296 12.8416 8.56368 13.7961 7.69441 14.7332C4.51286 18.2039 1.85287 21.2581 0.149093 23.115C0.0535278 23.2123 0 23.3431 0 23.4794C0 23.6157 0.0535278 23.7465 0.149093 23.8438C0.196182 23.8932 0.252824 23.9325 0.315583 23.9593C0.378341 23.9862 0.445909 24 0.514188 24C0.582468 24 0.650036 23.9862 0.712795 23.9593C0.775554 23.9325 0.832195 23.8932 0.879284 23.8438C2.91339 21.9176 6.37311 18.6377 10.1805 14.9241C10.7195 14.4035 11.2758 13.8308 11.8148 13.2928L13.0665 14.5597C16.6827 18.256 20.1598 21.6052 22.0201 23.3406C22.1328 23.4405 22.2794 23.4937 22.4301 23.4893C22.5808 23.4849 22.7241 23.4231 22.8307 23.3167C22.9373 23.2103 22.9992 23.0673 23.0036 22.9169C23.008 22.7665 22.9547 22.6201 22.8546 22.5076C21.2551 20.7722 18.4734 17.5965 15.3093 14.1605L13.2056 11.8872L15.6048 9.37093C18.4213 6.50759 21.203 3.6269 23.7934 1.24946C23.8528 1.19818 23.9014 1.13574 23.9366 1.06569C23.9718 0.995645 23.9928 0.919367 23.9984 0.841213C24.0041 0.763058 23.9943 0.684559 23.9695 0.610195C23.9448 0.535832 23.9056 0.467061 23.8542 0.407809C23.8029 0.348558 23.7403 0.299986 23.6701 0.264867C23.6 0.229748 23.5235 0.20877 23.4452 0.20313C23.367 0.19749 23.2883 0.207298 23.2138 0.231996C23.1393 0.256693 23.0704 0.295797 23.011 0.347072V0.416486Z" fill="black"/>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <nav 
      class="fixed top-0 right-0 h-full w-full bg-vera-cream shadow-xl transition-transform duration-300 p-8 z-[100]
        flex flex-col justify-center items-center gap-12 overflow-y-auto
        md:hidden"
      [class.translate-x-full]="!isOpen()"
    >
      <!-- Croix pour fermer -->
      <button
        (click)="isOpen.set(false)"
        class="absolute top-[20px] right-[20px] hover:opacity-70 transition-opacity focus:outline-none"
        [attr.aria-label]="'Fermer le menu'"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M23.011 0.416486C20.3511 2.60304 17.3955 5.18872 14.5095 7.87853C13.6055 8.72885 12.771 9.61388 11.8495 10.4642C11.2758 9.87419 10.7195 9.26681 10.111 8.72885C6.28618 4.87636 2.63522 1.56182 0.914055 0.156182C0.866966 0.10683 0.810325 0.0675378 0.747566 0.0406907C0.684807 0.0138435 0.617239 0 0.548959 0C0.48068 0 0.413112 0.0138435 0.350354 0.0406907C0.287595 0.0675378 0.230953 0.10683 0.183864 0.156182C0.0882987 0.253499 0.034771 0.384337 0.034771 0.520608C0.034771 0.656878 0.0882987 0.787716 0.183864 0.885033C1.66163 2.27332 4.49547 5.53579 7.8161 9.11063L10.3718 11.8525C9.43296 12.8416 8.56368 13.7961 7.69441 14.7332C4.51286 18.2039 1.85287 21.2581 0.149093 23.115C0.0535278 23.2123 0 23.3431 0 23.4794C0 23.6157 0.0535278 23.7465 0.149093 23.8438C0.196182 23.8932 0.252824 23.9325 0.315583 23.9593C0.378341 23.9862 0.445909 24 0.514188 24C0.582468 24 0.650036 23.9862 0.712795 23.9593C0.775554 23.9325 0.832195 23.8932 0.879284 23.8438C2.91339 21.9176 6.37311 18.6377 10.1805 14.9241C10.7195 14.4035 11.2758 13.8308 11.8148 13.2928L13.0665 14.5597C16.6827 18.256 20.1598 21.6052 22.0201 23.3406C22.1328 23.4405 22.2794 23.4937 22.4301 23.4893C22.5808 23.4849 22.7241 23.4231 22.8307 23.3167C22.9373 23.2103 22.9992 23.0673 23.0036 22.9169C23.008 22.7665 22.9547 22.6201 22.8546 22.5076C21.2551 20.7722 18.4734 17.5965 15.3093 14.1605L13.2056 11.8872L15.6048 9.37093C18.4213 6.50759 21.203 3.6269 23.7934 1.24946C23.8528 1.19818 23.9014 1.13574 23.9366 1.06569C23.9718 0.995645 23.9928 0.919367 23.9984 0.841213C24.0041 0.763058 23.9943 0.684559 23.9695 0.610195C23.9448 0.535832 23.9056 0.467061 23.8542 0.407809C23.8029 0.348558 23.7403 0.299986 23.6701 0.264867C23.6 0.229748 23.5235 0.20877 23.4452 0.20313C23.367 0.19749 23.2883 0.207298 23.2138 0.231996C23.1393 0.256693 23.0704 0.295797 23.011 0.347072V0.416486Z" fill="black"/>
        </svg>
      </button>

      <a 
        routerLink="/" 
        (click)="isOpen.set(false)"
        class="text-[24px] hover:opacity-80 transition-opacity"
      >
        {{ 'landing.footer.home' | translate }}
      </a>
      <a 
        routerLink="/vera"
        (click)="isOpen.set(false)"
        class="flex gap-[10px] items-center text-[20px] bg-vera-primary border border-black rounded-full px-[24px] py-[8px] hover:opacity-90 transition-opacity"
      >
        {{ 'landing.footer.talk_vera' | translate }}
        <svg width="15" height="12" viewBox="0 0 15 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.38564 11.9022C4.54959 11.6226 8.64624 9.55394 10.8493 8.64083C14.7822 7.0007 15.1827 6.70248 14.946 5.60299C14.6365 4.16803 11.4684 2.49064 6.02425 0.86924C2.83797 -0.0812519 2.14615 -0.174435 1.38139 0.216935C1.03545 0.384668 0.92617 0.626899 0.889753 1.13019C0.889753 1.1488 0.361733 9.23713 0.161441 9.38614C-0.949207 10.2063 4.02152 12.4986 4.38564 11.9022ZM2.87447 9.59132C2.74693 9.46077 3.07474 2.0247 3.20213 2.0247C3.275 2.0247 11.5595 4.59659 11.5595 5.00656C11.5777 5.39787 3.11109 9.83349 2.87447 9.59132Z" fill="black"/>
        </svg>
      </a>
      <a 
        href="https://github.com/iMxSquash/vera-extension"
        target="_blank" rel="noopener noreferrer"
        (click)="isOpen.set(false)"
        class="flex text-vera-primary bg-neutrals-900 text-[20px] border border-black rounded-full px-[24px] py-[8px] hover:opacity-90 transition-opacity"
      >
        {{ 'landing.hero.download_extension' | translate }}
      </a>
      <app-language-switcher></app-language-switcher>
    </nav>
  `,
})
export class HeaderMobileComponent {
  isOpen = signal(false);

  toggleMenu() {
    this.isOpen.update((val) => !val);
  }
}
