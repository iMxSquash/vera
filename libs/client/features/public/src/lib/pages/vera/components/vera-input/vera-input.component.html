<footer class="px-4 md:px-8 py-4">
    <div class="max-w-3xl mx-auto w-full">
        <!-- File Preview -->
        @if (selectedFile(); as file) {
        <div
            class="mb-4 group flex items-center gap-3 bg-neutrals-50 border border-vera-primary rounded-lg p-3 hover:bg-neutrals-100 transition-colors">
            @if (filePreview()) {
            <img [src]="filePreview()" alt="Preview" class="h-10 w-10 rounded-md object-cover flex-shrink-0" />
            } @else {
            <div class="h-10 w-10 rounded-md bg-vera-cream flex items-center justify-center flex-shrink-0">
                <vera-icon name="add" [size]="20" color="text-vera-primary"></vera-icon>
            </div>
            }

            <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutrals-900 truncate">{{ file.name }}</p>
                <p class="text-xs text-neutrals-600 opacity-0 group-hover:opacity-100 transition-opacity">{{ (file.size
                    /
                    1024 / 1024).toFixed(2) }}MB</p>
            </div>

            <button (click)="clearFile()"
                class="flex-shrink-0 p-1.5 text-neutrals-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors">
                <vera-icon name="cross" [size]="18"></vera-icon>
            </button>
        </div>
        }

        <!-- Input Area -->
        <div class="flex gap-3 bg-neutrals-50 items-end rounded-md p-1">
            <!-- Add Media Button with Dropdown -->
            <div class="relative" #mediaMenu (document:click)="closeMediaMenuIfClickedOutside($event, mediaMenu)">
                <button (click)="toggleMediaMenu()"
                    class="flex items-center justify-center h-12 w-12 rounded-[3px] bg-vera-primary hover:brightness-90 transition-colors"
                    title="{{ 'vera.input.add_media' | translate }}">
                    <vera-icon name="add" [size]="20" color="text-neutrals-900"></vera-icon>
                </button>

                <!-- Media Menu Bubble -->
                @if (showMediaMenu()) {
                <div
                    class="absolute bottom-16 left-0 bg-vera-primary rounded-2xl rounded-bl-sm shadow-lg p-4 min-w-max z-50 animate-in fade-in duration-200">
                    <div class="space-y-2">
                        <!-- Photo Option -->
                        <div class="border-b border-black">
                            <input type="file" id="file-upload-photo" class="hidden" (change)="onFileSelected($event)"
                                accept="image/*" />
                            <label for="file-upload-photo"
                                class="flex items-center gap-3 pb-2 rounded-[3px] cursor-pointer transition-colors group">
                                <vera-icon name="search-img" [size]="20" color="text-neutrals-900"></vera-icon>
                                <span class="text-sm text-neutrals-900 font-medium">{{ 'vera.input.add_photo' |
                                    translate
                                    }}</span>
                            </label>
                        </div>

                        <!-- Video Option -->
                        <div class="border-b border-black">
                            <input type="file" id="file-upload-video" class="hidden" (change)="onFileSelected($event)"
                                accept="video/*" />
                            <label for="file-upload-video"
                                class="flex items-center gap-3 py-2 rounded-[3px] cursor-pointer transition-colors">
                                <vera-icon name="video-player" [size]="20" color="text-neutrals-900"></vera-icon>
                                <span class="text-sm text-neutrals-900 font-medium">{{ 'vera.input.add_video' |
                                    translate
                                    }}</span>
                            </label>
                        </div>

                        <!-- Audio Option -->
                        <div>
                            <input type="file" id="file-upload-audio" class="hidden" (change)="onFileSelected($event)"
                                accept="audio/*" />
                            <label for="file-upload-audio"
                                class="flex items-center gap-3 pt-2 rounded-[3px] cursor-pointer transition-colors">
                                <vera-icon name="mic" [size]="20" color="text-neutrals-900"></vera-icon>
                                <span class="text-sm text-neutrals-900 font-medium">{{ 'vera.input.add_audio' |
                                    translate
                                    }}</span>
                            </label>
                        </div>
                    </div>
                </div>
                }
            </div>

            <!-- Question Input -->
            <textarea id="vera-question-input" name="question" [(ngModel)]="question" (keydown)="onKeyDown($event)"
                [disabled]="isLoading()" placeholder="{{ 'vera.input.placeholder' | translate }}"
                class="flex-1 my-auto border-transparent rounded-[3px] focus:outline-none focus:ring-0 resize-none disabled:bg-neutrals-100 h-auto max-h-[48px] disabled:text-neutrals-600"
                rows="1"></textarea>

            <!-- Submit Button -->
            <button (click)="onSubmit()" [disabled]="isLoading() || (!question().trim() && !selectedFile())"
                class="flex items-center justify-center h-12 w-12 bg-vera-primary hover:brightness-90 text-neutrals-900 disabled:text-neutrals-900 rounded-[3px] transition-colors duration-200 disabled:bg-neutrals-400 disabled:cursor-not-allowed font-medium whitespace-nowrap">
                @if (isLoading()) {
                <vera-icon name="conv-chat" [size]="20"></vera-icon>
                } @else {
                <vera-icon name="send" [size]="20" color="text-neutrals-900"></vera-icon>
                }
            </button>
        </div>
    </div>
</footer>