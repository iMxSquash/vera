<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-8">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-slate-900 mb-2">Testeur Fact-Check Vera</h1>
            <p class="text-slate-600">
                Testez l'API de v√©rification de faits. Entrez un fait ou une affirmation √† v√©rifier, ou s√©lectionnez une
                image/vid√©o √† analyser.
            </p>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="mb-6">
                <label for="query" class="block text-sm font-semibold text-slate-900 mb-2">
                    Fait √† v√©rifier (optionnel si image s√©lectionn√©e)
                </label>
                <textarea id="query" [(ngModel)]="query" [disabled]="isLoading()"
                    placeholder="Ex: Le changement climatique est r√©el et caus√© par les activit√©s humaines (optionnel si vous avez s√©lectionn√© une image)"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-lg focus:outline-none focus:border-blue-500 resize-none transition-colors disabled:bg-slate-50 disabled:cursor-not-allowed"
                    rows="4"></textarea>
                <p class="text-xs text-slate-500 mt-1">Caract√®res : {{ query().length }}</p>
            </div>

            <!-- Image Upload Section -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-slate-900 mb-2">
                    M√©dia √† analyser (image ou vid√©o - peut √™tre utilis√© seul pour v√©rification)
                </label>
                <div class="border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors cursor-pointer"
                    (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
                    [class.border-blue-500]="isDragOver()" [class.bg-blue-50]="isDragOver()">
                    @if (!selectedImage()) {
                    <div class="space-y-2">
                        <div class="text-slate-500">
                            <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path
                                    d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </div>
                        <div class="text-sm text-slate-600">
                            Cliquez pour s√©lectionner une image ou vid√©o ou glissez-d√©posez
                        </div>
                        <input type="file" accept="image/*,video/*" (change)="onImageSelected($event)" class="hidden"
                            id="imageInput">
                        <label for="imageInput"
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 cursor-pointer transition-colors">
                            S√©lectionner un m√©dia
                        </label>
                    </div>
                    } @else {
                    <div class="space-y-2">
                        @if (selectedMediaType() === 'image') {
                        <img [src]="imagePreview()" [alt]="selectedImage()?.name"
                            class="mx-auto max-h-32 rounded-lg shadow-sm">
                        } @else if (selectedMediaType() === 'video') {
                        <video [src]="imagePreview()" controls class="mx-auto max-h-32 rounded-lg shadow-sm">
                            Votre navigateur ne supporte pas la lecture de vid√©os.
                        </video>
                        }
                        <div class="text-sm text-slate-700 font-medium">{{ selectedImage()?.name }}</div>
                        <div class="text-xs text-slate-500">{{ ((selectedImage()?.size || 0) / 1024 / 1024).toFixed(2)
                            }} MB</div>
                        <button (click)="removeImage()" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            ‚úï Supprimer
                        </button>
                    </div>
                    }
                </div>
            </div>

            <!-- User ID Display -->
            <div class="mb-6 p-3 bg-slate-50 rounded-lg border border-slate-200">
                <p class="text-xs text-slate-600 font-mono">
                    ID utilisateur : <span class="font-semibold">{{ userId() }}</span>
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3">
                <button (click)="submitFactCheck()" [disabled]="!canSubmit()"
                    class="flex-1 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2">
                    @if (!isLoading()) {
                    <span>üîç V√©rifier</span>
                    } @else {
                    <span>‚è≥ V√©rification...</span>
                    }
                </button>
                <button (click)="clearForm()" [disabled]="isLoading()"
                    class="px-6 py-3 bg-slate-200 text-slate-900 font-semibold rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                    ‚úï R√©initialiser
                </button>
            </div>
        </div>

        <!-- Error Message -->
        @if (error()) {
        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg mb-6">
            <p class="text-sm font-semibold text-red-700">Erreur</p>
            <p class="text-sm text-red-600 mt-1">{{ error() }}</p>
        </div>
        }

        <!-- Response Card -->
        @if (response()) {
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-lg font-bold text-slate-900 mb-4">R√©sultat de la v√©rification</h2>
            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                <p class="text-slate-700 whitespace-pre-wrap leading-relaxed"
                    [innerHTML]="formatResponseWithLinks(response())"></p>
            </div>
        </div>
        }

        <!-- History Section -->
        @if (factChecksHistory().length > 0) {
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-slate-900">Historique des v√©rifications</h2>
                <button (click)="clearHistory()"
                    class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                    üóëÔ∏è Effacer tout
                </button>
            </div>
            <div class="space-y-3 max-h-96 overflow-y-auto">
                @for (factCheck of factChecksHistory(); track factCheck.id) {
                <div class="border border-slate-200 rounded-lg p-4 hover:bg-slate-50 transition-colors">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-slate-900 mb-1 line-clamp-2">{{ factCheck.query }}</p>
                            <p class="text-xs text-slate-500">
                                {{ formatTimestamp(factCheck.timestamp) }}
                            </p>
                        </div>
                        <button (click)="reloadFactCheck(factCheck)"
                            class="ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                            ‚Üª Recharger
                        </button>
                    </div>
                    <div class="bg-slate-50 p-3 rounded border-l-4 border-blue-500">
                        <p class="text-sm text-slate-700 line-clamp-3"
                            [innerHTML]="formatResponseWithLinks(factCheck.response)"></p>
                    </div>
                </div>
                }
            </div>
        </div>
        }

        <!-- Links Preview -->
        @if (extractedLinks().length > 0) {
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-lg font-bold text-slate-900 mb-4">Liens trouv√©s</h2>
            <div class="space-y-3">
                @for (link of extractedLinks(); track link) {
                <div class="border border-slate-200 rounded-lg p-4 hover:bg-slate-50 transition-colors">
                    <div class="flex items-start gap-3">
                        <img [src]="getFaviconUrl(link)" [alt]="getDomain(link) + ' favicon'"
                            class="w-6 h-6 flex-shrink-0 rounded" (error)="onImageError($event)" />
                        <div class="flex-1 min-w-0">
                            <a [href]="link" target="_blank" rel="noopener noreferrer"
                                class="text-blue-600 hover:text-blue-800 font-medium break-all block">
                                {{ link }}
                            </a>
                            <div class="mt-1 text-sm text-slate-600">
                                {{ getDomain(link) }}
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
        } <!-- Info Section -->
        <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h3 class="font-semibold text-blue-900 mb-2">‚ÑπÔ∏è √Ä propos</h3>
            <p class="text-sm text-blue-800">
                Cette page teste l'int√©gration avec l'API Vera. Les v√©rifications sont effectu√©es en temps r√©el
                par le syst√®me de fact-checking de Vera.
            </p>
        </div>
    </div>
</div>